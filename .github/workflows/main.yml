name: decathlon-bikes_automacao
run-name: ${{ github.actor }} Pipeline deploy
on:
  push:
    branches:
      - "develop"
    paths-ignore:
      - "*.txt"
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        if: always()
        uses: actions/checkout@v2
        
      - name: INSTALL PACKAGES
        run: |
          sudo apt update -y
          wget -O- https://apt.releases.hashicorp.com/gpg | \
            gpg --dearmor | \
            sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg > /dev/null
         
          echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] \
            https://apt.releases.hashicorp.com $(lsb_release -cs) main" | \
            sudo tee /etc/apt/sources.list.d/hashicorp.list
          sudo apt update -y
          sudo apt install unzip terraform -y
          
      - name: Terraform Apply
        if: always()
        run: |
          terraform init
          terraform apply --auto-approve
          security_group_id=$(terraform output security_group_id)


          
